<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Design: Causation</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #202124;
            --accent-color: #d93025;
            --primary-color: #1a73e8;
            --node-fill: #ffffff;
            --node-stroke: #5f6368;
            --line-color: #dadce0;
            --panel-bg: #ffffff;
            --panel-width: 500px;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Layout */
        #mindmap-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background-image: radial-gradient(#dee1e6 1px, transparent 1px);
            background-size: 20px 20px;
            /* Adjust width to account for fixed panel */
            width: calc(100vw - var(--panel-width));
        }

        #info-panel {
            width: var(--panel-width);
            background: var(--panel-bg);
            border-left: 1px solid #dadce0;
            padding: 40px;
            box-shadow: -5px 0 20px rgba(0,0,0,0.05);
            overflow-y: auto;
            z-index: 100;
            position: relative; /* Changed from fixed to flow with flexbox */
            height: 100%;
        }

        /* Typography */
        h2 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 28px;
            margin-top: 0;
            margin-bottom: 20px;
            color: #202124;
            border-bottom: 2px solid #f1f3f4;
            padding-bottom: 15px;
        }

        .explanation-text {
            font-size: 16px;
            line-height: 1.8;
            color: #3c4043;
            margin-bottom: 20px;
        }

        .example-section {
            font-size: 15px;
            line-height: 1.7;
            color: #5f6368;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            margin-top: 20px;
        }

        /* SVG Diagram Styles */
        .diagram-container {
            width: 100%;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            margin: 20px 0;
            padding: 10px;
            display: flex;
            justify-content: center;
        }

        .diagram-svg text {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 12px;
            fill: #333;
            text-anchor: middle;
        }

        /* D3 Styles */
        .node circle {
            fill: var(--node-fill);
            stroke: var(--node-stroke);
            stroke-width: 2.5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node circle:hover {
            stroke: var(--primary-color);
            fill: #e8f0fe;
        }

        .node text {
            font: 14px 'Space Grotesk', sans-serif;
            font-weight: 500;
            fill: #3c4043;
            cursor: pointer;
        }

        .link {
            fill: none;
            stroke: var(--line-color);
            stroke-width: 2px;
        }
        
        @media (max-width: 768px) {
            body { flex-direction: column; }
            #mindmap-container { width: 100%; height: 50%; }
            #info-panel { width: 100%; height: 50%; border-left: none; border-top: 1px solid #dadce0; }
        }
    </style>
</head>
<body>

    <div id="mindmap-container">
        <svg width="100%" height="100%"></svg>
    </div>

    <div id="info-panel">
        <div id="content-display"></div>
    </div>

    <script>
        // --- SVG DIAGRAM TEMPLATES ---
        
        const svgCausalSpurious = `
            <svg class="diagram-svg" width="400" height="250" viewBox="0 0 400 250">
                <g transform="translate(0, 20)">
                    <text x="200" y="0" font-weight="bold" font-size="14" fill="#1a73e8">True Causal (X → Y)</text>
                    <rect x="100" y="20" width="60" height="40" rx="5" fill="#e8f0fe" stroke="#1a73e8"/>
                    <text x="130" y="45">X</text>
                    <text x="130" y="75" font-size="10">(Cause)</text>
                    <rect x="240" y="20" width="60" height="40" rx="5" fill="#e8f0fe" stroke="#1a73e8"/>
                    <text x="270" y="45">Y</text>
                    <text x="270" y="75" font-size="10">(Effect)</text>
                    <line x1="160" y1="40" x2="240" y2="40" stroke="#1a73e8" stroke-width="3" marker-end="url(#arrowhead)"/>
                </g>
                <line x1="50" y1="100" x2="350" y2="100" stroke="#eee" stroke-width="2"/>
                <g transform="translate(0, 120)">
                    <text x="200" y="0" font-weight="bold" font-size="14" fill="#d93025">Spurious (Z causes X & Y)</text>
                    <circle cx="200" cy="30" r="25" fill="#fce8e6" stroke="#d93025" stroke-width="2"/>
                    <text x="200" y="35" font-weight="bold">Z</text>
                    <rect x="100" y="90" width="60" height="40" rx="5" fill="#fff" stroke="#5f6368"/>
                    <text x="130" y="115">X</text>
                    <rect x="240" y="90" width="60" height="40" rx="5" fill="#fff" stroke="#5f6368"/>
                    <text x="270" y="115">Y</text>
                    <line x1="180" y1="45" x2="130" y2="90" stroke="#d93025" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="220" y1="45" x2="270" y2="90" stroke="#d93025" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <path d="M 160 110 Q 200 130 240 110" stroke="#5f6368" stroke-width="1" stroke-dasharray="4"/>
                    <text x="200" y="125" font-size="10" fill="#5f6368">Mere Correlation</text>
                </g>
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#555" />
                    </marker>
                </defs>
            </svg>
        `;

        const svgComponents = `
            <svg class="diagram-svg" width="400" height="150" viewBox="0 0 400 150">
                <g transform="translate(20, 20)">
                    <rect x="0" y="0" width="100" height="100" rx="10" fill="#fff" stroke="#1a73e8"/>
                    <text x="50" y="30" font-weight="bold">1. Covariation</text>
                    <text x="50" y="60" font-size="10">If X moves,</text>
                    <text x="50" y="75" font-size="10">Y moves.</text>
                </g>
                <g transform="translate(140, 20)">
                    <rect x="0" y="0" width="100" height="100" rx="10" fill="#fff" stroke="#1a73e8"/>
                    <text x="50" y="30" font-weight="bold">2. Time Order</text>
                    <text x="50" y="60" font-size="10">X happens</text>
                    <text x="50" y="75" font-size="10">BEFORE Y.</text>
                </g>
                <g transform="translate(260, 20)">
                    <rect x="0" y="0" width="120" height="100" rx="10" fill="#fff" stroke="#1a73e8"/>
                    <text x="60" y="30" font-weight="bold">3. No 'Z'</text>
                    <text x="60" y="60" font-size="10">Rule out</text>
                    <text x="60" y="75" font-size="10">alternatives.</text>
                </g>
            </svg>
        `;

        // --- DATA STRUCTURE ---
        const treeData = {
            name: "Causation",
            type: "Root",
            description: "The central goal of research design: Moving beyond observing <em>what</em> happened to explaining <em>why</em> it happened by establishing causal relationships.",
            children: [
                {
                    name: "1. Causal vs. Spurious",
                    type: "Concept",
                    description: "The most important distinction in research. A <strong>Causal</strong> relationship means X creates Y. A <strong>Spurious</strong> relationship means X and Y only look related because both are caused by Z.",
                    diagram: svgCausalSpurious,
                    example: "<p><strong>Example: Peyton Manning & Voting</strong></p><p>We see a correlation: People who like Peyton Manning (X) vote Republican (Y).</p><p><strong>Why it's Spurious:</strong> Being a football fan doesn't make you a Republican. <strong>Gender (Z)</strong> is the real cause. Men are more likely to watch football (X) AND men are more likely to vote Republican (Y). When we control for gender, the relationship disappears.</p>"
                },
                {
                    name: "2. Three Components",
                    type: "Rules",
                    description: "To scientifically prove that X causes Y, you must demonstrate three things simultaneously.",
                    diagram: svgComponents,
                    example: "<p><strong>1. Covariation:</strong> The variables must move together. (e.g., Higher education is linked to higher voter turnout).</p><p><strong>2. Time Order:</strong> The cause must happen in time before the effect. (e.g., You must get the degree <em>before</em> you vote).</p><p><strong>3. Elimination of Alternatives:</strong> You must prove that income or age (Z) isn't the real reason for the relationship.</p>"
                },
                {
                    name: "3. Classical Experiment",
                    type: "Method",
                    description: "The randomized controlled experiment is the 'Gold Standard' because it automatically satisfies the three components.",
                    children: [
                        { 
                            name: "Randomization", 
                            description: "By randomly assigning subjects to groups, we ensure the groups are statistically identical on all characteristics (Age, Gender, Income) <em>except</em> the one we are testing. This effectively neutralizes all potential confounding variables (Z).",
                            example: "In the Nownes experiment, randomization meant the 'Manning' group and 'Control' group had the exact same percentage of men and women. This eliminates Gender (Z) as an alternative explanation."
                        },
                        { 
                            name: "Treatment vs Control", 
                            description: "In an experiment, the <strong>Treatment Group</strong> receives the stimulus (the independent variable), while the <strong>Control Group</strong> receives nothing (or a placebo). The control group serves as the critical baseline or 'counterfactual'—it shows us what happens when X is absent. Without a control group, we cannot be certain if a change in Y was caused by the treatment or by external factors like history or maturation.",
                            example: "Treatment Group read a bio about Manning's politics. Control Group read about his pets. Because the only difference was the bio, any difference in party support must be caused by the bio (Covariation established)."
                        }
                    ]
                },
                {
                    name: "4. Validity",
                    type: "Accuracy",
                    description: "How much confidence can we have in our causal conclusions?",
                    children: [
                        { 
                            name: "Internal Validity", 
                            description: "Confidence that X caused Y <em>inside</em> the study. High in experiments because we control the environment.",
                            example: "We know for a fact the students read the bio because we watched them do it in the lab."
                        },
                        { 
                            name: "External Validity", 
                            description: "Confidence that the results apply to the <em>real world</em>. Often low in experiments.",
                            example: "The study used 503 college students. Do they represent the voting habits of 65-year-old retirees? Maybe not. The study has low external validity."
                        }
                    ]
                },
                {
                    name: "5. Distinctions: Quant vs Qual",
                    type: "Methodology",
                    description: "Two different cultures of research design.",
                    example: "<p><strong>Quantitative (Large N):</strong> Focuses on numerical data and statistical analysis across many cases. Uses broad surveys or datasets.</p><p><strong>Qualitative (Small N):</strong> Focuses on non-numerical data and deep analysis of single cases. Uses interviews, archives, or observation.</p>"
                },
                {
                    name: "6. Two Approaches",
                    type: "Philosophy",
                    description: "How we frame the causal question (based on Mahoney & Goertz).",
                    children: [
                        { 
                            name: "Effects-of-Causes", 
                            description: "<strong>Quantitative Approach:</strong> Starts with a potential cause (X) and asks 'What is its average effect?'",
                            example: "Question: 'What is the average effect of an increase in education on income across the US population?'" 
                        },
                        { 
                            name: "Causes-of-Effects", 
                            description: "<strong>Qualitative Approach:</strong> Starts with a specific outcome (Y) and asks 'What caused this?'",
                            example: "Question: 'What specific factors caused the 2008 Financial Crisis?' (Looking backward to explain a specific event)." 
                        }
                    ]
                }
            ]
        };

        // --- D3 LOGIC ---
        const container = document.getElementById('mindmap-container');
        const width = container.clientWidth;
        const height = container.clientHeight;

        const svg = d3.select("svg")
            .attr("viewBox", [-100, -height/2, width, height])
            .call(d3.zoom().on("zoom", (event) => {
                g.attr("transform", event.transform);
            }));

        const g = svg.append("g");

        let i = 0,
            duration = 750,
            root;

        // Tree Layout: [vertical spacing, horizontal spacing]
        const treeMap = d3.tree().nodeSize([60, 250]); 

        root = d3.hierarchy(treeData, function(d) { return d.children; });
        root.x0 = 0;
        root.y0 = 0;

        // Collapse logic
        function collapse(d) {
            if(d.children) {
                d._children = d.children;
                d._children.forEach(collapse);
                d.children = null;
            }
        }
        
        // Initial state: Expand level 1, collapse deeper levels
        if(root.children) {
            root.children.forEach(d => {
                if(d.children) {
                    d.children.forEach(collapse); 
                }
            });
        }

        update(root);

        // Initialize Panel with Root Data
        updateInfoPanel(treeData);

        function update(source) {
            const treeRoot = treeMap(root);
            const nodes = treeRoot.descendants();
            const links = treeRoot.links();

            // Normalize for fixed-depth layout (Left to Right)
            nodes.forEach(function(d){ d.y = d.depth * 250}); 

            const node = g.selectAll('g.node')
                .data(nodes, function(d) {return d.id || (d.id = ++i); });

            const nodeEnter = node.enter().append('g')
                .attr('class', 'node')
                .attr("transform", function(d) {
                    return "translate(" + source.y0 + "," + source.x0 + ")";
                })
                .on('click', clickNode);

            nodeEnter.append('circle')
                .attr('class', 'node')
                .attr('r', 1e-6)
                .style("fill", function(d) {
                    return d._children ? "#1a73e8" : "#fff";
                });

            nodeEnter.append('text')
                .attr("dy", ".35em")
                .attr("x", function(d) {
                    return d.children || d._children ? -15 : 15;
                })
                .attr("text-anchor", function(d) {
                    return d.children || d._children ? "end" : "start";
                })
                .text(function(d) { return d.data.name; });

            const nodeUpdate = nodeEnter.merge(node);

            nodeUpdate.transition()
                .duration(duration)
                .attr("transform", function(d) { 
                    return "translate(" + d.y + "," + d.x + ")";
                });

            nodeUpdate.select('circle.node')
                .attr('r', 8) 
                .style("fill", function(d) {
                    return d._children ? "#1a73e8" : "#fff";
                });

            const nodeExit = node.exit().transition()
                .duration(duration)
                .attr("transform", function(d) {
                    return "translate(" + source.y + "," + source.x + ")";
                })
                .remove();

            nodeExit.select('circle').attr('r', 1e-6);
            nodeExit.select('text').style('fill-opacity', 1e-6);

            const link = g.selectAll('path.link')
                .data(links, function(d) { return d.target.id; });

            const linkEnter = link.enter().insert('path', "g")
                .attr("class", "link")
                .attr('d', function(d){
                    const o = {x: source.x0, y: source.y0}
                    return diagonal(o, o)
                });

            const linkUpdate = linkEnter.merge(link);
            linkUpdate.transition().duration(duration).attr('d', function(d){ return diagonal(d.source, d.target) });
            
            const linkExit = link.exit().transition().duration(duration).attr('d', function(d) {
                const o = {x: source.x, y: source.y}
                return diagonal(o, o)
            }).remove();

            nodes.forEach(function(d){
                d.x0 = d.x;
                d.y0 = d.y;
            });

            function diagonal(s, d) {
                return `M ${s.y} ${s.x}
                        C ${(s.y + d.y) / 2} ${s.x},
                          ${(s.y + d.y) / 2} ${d.x},
                          ${d.y} ${d.x}`;
            }

            function clickNode(event, d) {
                if (d.children) {
                    d._children = d.children;
                    d.children = null;
                } else {
                    d.children = d._children;
                    d._children = null;
                }
                update(d);
                updateInfoPanel(d.data);
                event.stopPropagation();
            }
        }

        function updateInfoPanel(data) {
            const display = document.getElementById('content-display');
            let diagramHtml = '';
            if (data.diagram) {
                diagramHtml = `<div class="diagram-container">${data.diagram}</div>`;
            }
            display.innerHTML = `
                <h2>${data.name}</h2>
                <div class="explanation-text">${data.description || ''}</div>
                ${diagramHtml}
                ${data.example ? `<div class="example-section">${data.example}</div>` : ''}
            `;
        }
    </script>
</body>
</html>
